<%layout("/eeda/layout.html"){%>
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <input id="order_id" type="hidden" name="order_id" value="${order.id!''}"/>
                    <input id="company_id" type="hidden" name="company_id" value="${order.company_id!''}" />
                    <input id="company_abbr" type="hidden" name="company_abbr" value="${order.company_abbr!''}" />
                    <input id="tjor_id" type="hidden" name="tjor_id" value="" />
                </div>
            </div>
            <!-- /.row -->
            <div class="row simple_search_div">
                <div class="col-lg-12">
                		<form role="form" id="costCheckOrderForm">
                                <div class="row">
                                        	<input id="id" type="hidden" value="${order.id!''}"/>
                                        	<input id="ids" type="hidden"  value="${order.ids!''}"/>
                                        	<input id="sp_id" type="hidden"  value="${order.sp_id!''}"/>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'order_no', 
                                                                    label:'对账单号', 
                                                                    value: order.order_no!'',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'status', 
                                                                    label:'单据状态', 
                                                                    value: order.audit_status!order.status!'新建',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'creator', 
                                                                    label:'创建人', 
                                                                    value: order.creator_name!'',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'create_stamp', 
                                                                    label:'创建时间', 
                                                                    value: order.create_stamp!'',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'confirm_name', 
                                                                    label:'确认人', 
                                                                    value: order.confirm_by_name!'',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'confirm_stamp', 
                                                                    label:'确认时间', 
                                                                    value: order.confirm_stamp!'',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'sp_name', 
                                                                    label:'结算公司', 
                                                                    value: order.company_name!'',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputDateQueryField.html", 
                                            {   id:'audit', 
                                                label:'对账时间段', 
                                                begin_value: order.begin_time!'',
                                                required:'required',
                                                end_value: order.end_time!''
                                            }){} %>
                                        </div>
                                        <div class="col-lg-4">
                                            <%include("/eeda/component/form/inputField.html", 
                                                                {   id:'return_reason', 
                                                                    label:'退单原因', 
                                                                    value: order.return_reason!'',
                                                                    disabled: 'disabled'
                                                                }){}%>
                                        </div>
                                </div>
                                 <div class="row">
                                     <div class="col-lg-12">
                                         <label>备注</label>
                                         <textarea class="form-control" rows="4" id="remark">${order.remark!''}</textarea>
                                     </div>
                                </div>
                                
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-lg-12">
                                            <h4>对账币值金额汇总</h4>
                                        </div>
                                    </div>
                               </div>
                                <div class="row">
                                    <div class="col-lg-3">
                                        <%include("/eeda/component/form/inputField.html", { id:'cny_duizhang',
                                        label:'应付CNY', value:order.cny_duizhang!'',disabled:'disabled'
                                        }){}%>
                                    </div>
                                    <div class="col-lg-3">
                                        <%include("/eeda/component/form/inputField.html", { id:'usd_duizhang',
                                        label:'应付USD', value:order.usd_duizhang!'',disabled:'disabled'
                                        }){}%>
                                    </div>
                                    <div class="col-lg-3">
                                        <%include("/eeda/component/form/inputField.html", { id:'hkd_duizhang',
                                        label:'应付HKD', value:order.hkd_duizhang!'',disabled:'disabled'
                                        }){}%>
                                    </div>
                                    <div class="col-lg-3">
                                        <%include("/eeda/component/form/inputField.html", { id:'jpy_duizhang',
                                        label:'应付JPY', value:order.jpy_duizhang!'',disabled:'disabled'
                                        }){}%>
                                    </div>
                                </div>
                               
                                <div class="row" style="margin-top: 5px;">
                                    <div class="col-lg-12">
                                        <div class="btn-header" style="font-size: 18px">结算金额汇总</div>
                                    </div>
					                <div class="col-lg-3">
					                    <%include("/eeda/component/form/inputField.html", { id:'cny',
					                    label:'应付CNY', value:order.cny!'',disabled:'disabled'
					                    }){}%>
					                </div>
					                <div class="col-lg-3">
					                    <%include("/eeda/component/form/inputField.html", { id:'usd',
					                    label:'应付USD', value:order.usd!'',disabled:'disabled'
					                    }){}%>
					                </div>
					                <div class="col-lg-3">
					                    <%include("/eeda/component/form/inputField.html", { id:'hkd',
					                    label:'应付HKD', value:order.hkd!'',disabled:'disabled'
					                    }){}%>
					                </div>
					                <div class="col-lg-3">
					                    <%include("/eeda/component/form/inputField.html", { id:'jpy',
					                    label:'应付JPY', value:order.jpy!'',disabled:'disabled'
					                    }){}%>
					                </div>
					            </div>
                                
                                </form>
                                </div>
                                </div>
                                
                                <div class="simple_order_list_div">
                                <div class="group-form" style="margin-top: 15px;">
									<ul id="orderTabs" class="nav nav-tabs">
										<li class="active"><a href="#itemDetail" data-toggle="tab"
											id="costCheckOrderItem">明细信息</a></li>
									</ul>
									<br>
									
                                <div class=col-lg-12>
                                <div class="row">
                                     <div class="col-lg-4">
                                        <%include("/eeda/component/form/selectField.html", 
                                                    {   id:'query_currency',
                                                        label:'选中查询币种', 
                                                        value:'',
                                                        value_list:[
                                                            {code:'',value:''},
                                                            {code:'CNY', value:'CNY'},
                                                            {code:'USD', value:'USD'},
                                                            {code:'HKD', value:'HKD'},
                                                            {code:'JPY', value:'JPY'}
                                                        ]
                                                    }){}%>
                                    </div>
                                    <button id='query_listCurrency' class="btn btn_grey">查询</button>
                                </div>
	                                <div class="group-form"  id="currencyDiv">
					                    <div class="row">
					                        <div class="col-lg-4">
					                            <%include("/eeda/component/form/selectField.html", 
					                                        {   id:'exchange_currency',
					                                            label:'选中行', 
					                                            value:'',
					                                            value_list:[
					                                                {code:'CNY', value:'兑换成CNY'},
					                                                {code:'USD', value:'兑换成USD'},
					                                                {code:'HKD', value:'兑换成HKD'},
					                                                {code:'JPY', value:'兑换成JPY'}
					                                            ]
					                                        }){}%>
					                        </div>
					                        <div class="col-lg-4">
					                            <%include("/eeda/component/form/inputField.html", { id:'exchange_rate',
					                            label:'兑换汇率'
					                            }){}%>
					                        </div>
					                        <button id='exchange' class="btn btn_green">兑换</button>
					                    </div>
								    </div>
								    <div class="table_btn_bar">
								   	 	<button class="btn btn_blue" id="add_cost" disabled>添加明细</button> 
								    </div>
								</div>
	                               <%include("/eeda/component/form/detailTable.html", 
	                                   {
	                                       id:'eeda-table', 
	                                       headers:[
	                                           '<input type="checkbox" id="allcheck" >',
                                               '操作',
	                                           '工作单号',
	                                           '类型',
	                                           '创建时间',
	                                           '客户',
	                                           '结算公司',
                                               '费用名称',
	                                           '对账币制',
			                                   '对账金额', 
			                                   '原汇率',
			                                   '原总金额(CNY)',  
			                                   '当前汇率',
			                                   '当前总金额(CNY)', 
			                                   '结算币制', 
			                                   '结算汇率', 
			                                   '结算金额',
			                                   ''
	                                       ],
	                                       field_list:[
	                                           'ID', 
                                               '',
	                                           'ORDER_NO', 
	                                           'TYPE', 
	                                           'CREATE_STAMP',
	                                           'CUSTOMER_NAME', 
	                                           'SP_NAME', 
                                               'fin_name',
	                                           'CURRENCY_NAME',
	                                           'TOTAL_AMOUNT',
	                                           'EXCHANGE_RATE',
	                                           'AFTER_TOTAL', 
	                                           'NEW_RATE', 
	                                           'AFTER_RATE_TOTAL',
	                                           'EXCHANGE_CURRENCY_NAME',
	                                           'EXCHANGE_CURRENCY_RATE',
	                                           'EXCHANGE_TOTAL_AMOUNT',
	                                           'ORDER_TYPE',
                                               'JOB_ORDER_ID'
	                                       ],
	                                       value_list: order.item_list!item_list![]
	                                   }){} %>
	                               </div>
                                
                                <!-- /.panel-body -->
          <div class="form-group">
                <div class="col-lg-12">
                    <br>    
                    <button id="saveBtn" type="button" class="btn  btn_green" disabled>保存</button> 
                    <button id='refuseBtn' class="btn  btn_red guide_confrimBtn" disabled>退单</button> 
                    <% if(shiro.hasPermission("tradeCostCheckOrder.confirm")){%>
                        <button id="confirmBtn" type="button" class="btn btn_green" disabled>确认</button>
	                <%}%>
	                <button id="cancelConfirmBtn" type="button" class="btn btn_green guide_target4" disabled>取消确认</button>
                	<button id="printBtn"  type="button" class="btn btn_white" disabled>生成明细对账单(PDF)</button>
                	<a class="btn btn_white" href="/tradeCostCheckOrder">返回</a>
                	<a href="/tradeCostRequest/create" class="btn btn_green" type="button" >创建申请单</a>
                </div>
         </div>
        </div>
        <!-- /#page-wrapper -->
        <a id='cost_table_msg_btn' data-target='#cost_table_msg' data-toggle='modal' style='display:none'></a>
      <div class="modal fade" id="cost_table_msg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                      <div class="row">
                            <div class="col-lg-4">
                                <%include("/eeda/component/form/inputSpField.html", 
                                    {
                                        id:'que_sp', 
                                        label:'结算公司', 
                                        value: '',
                                        required: 'required'
                                }){} %>
                            </div>
                            <div class="col-lg-4">
                                <%include("/eeda/component/form/inputField.html", 
                                    {   id: 'que_order_no', 
                                        label: '工作单号', 
                                        value: ''
                                    }){}%>
                            </div>    
                      </div>    
                       <div class="row">
                            <div class="col-lg-4">
                                 <%include("/eeda/component/form/inputDateQueryField.html", 
                                         {   id:'que_order_export_date', 
                                             label:'出货日期'
                                         }){} %>
                             </div>
                             <div class="col-lg-4">
                                    <%include("/eeda/component/form/inputCustomerField.html", 
                                         {   id: 'que_customer', 
                                             label: '客户', 
                                             value: ''
                                         }){}%>
                           </div>
                      </div>    
                         <div class="form-group button-bar" >
                            <button id="searchBtn" class="btn btn-primary btn-sm" type="button">查询</button>
                            <button id="resetBtn" class="btn btn-default btn-sm" type="button">清空条件</button>
                            &nbsp&nbsp<input type="checkbox" name="checkOrderAll" id="checkOrderAll" value="Y">查看应收应付<span style="color:red">(红色为应收)</span>
                        </div>
                      <br>
                     <%include("/eeda/component/form/detailTable.html", 
                                        {
                                            id:'eeda_cost_table', 
                                            style: 'width:1800px',
                                            headers:['<input type="checkbox" id="allcost">','工作单号','出货时间','创建时间','类型','费用名称','客户','结算公司',
                                            '金额','货币类型','汇率','总金额（CNY）','结算币制','结算汇率','结算金额',
                                             'FND', '体积(CBM)', '箱量', '净重重量', 'REF_NO', 'MBL_NO','HBL_NO','箱号','车型'
                                            ]
                                        }){} %>
                </div>
                <div class="modal-footer">
                     <button id="add_cost_item" type="button" class="btn  btn_green save" data-dismiss="modal">添加</button>
                     <button type="button" class="btn  btn_white" data-dismiss="modal">返回</button>
               </div>
            </div>
        </div>
      </div>
</div>

				<!-- begin fade -->
				<a data-target='#deleteReasonDetail' data-toggle='modal'>
				    <button id="deleteReasonDetailAlert" style="display:none"></button>
				</a>
				         <div class="modal fade" id="deleteReasonDetail">
				          <div class="modal-dialog">
				            <div class="modal-content">
				              <div class="modal-header">请填写退单原因</div>
				                <div class="modal-body">
				                    <input id="delete_id" type="hidden">
				                    <form id="deleteReasonDetailForm">
				                     <div class="form-group">
				                     <select class="form-control search-control deleteReason">
				                     <option>金额不对</option>  
				                     <option>日期不对</option>                   
				                     </select><br/><br/>
				                     <textarea id='deleteReason' name="deleteReason" class="form-control" rows="3" required></textarea>
				                     </div>
				                     </form>
				                </div>
				              <div class="modal-footer">
				                <button class="btn  btn-default return" data-dismiss="modal">返回</button>
				                <button class="btn btn-primary confirm" >确定退单</button>
				            </div>
				        </div>
				      </div>
				      </div>
	<a id='cost_editBtn' data-target='#cost_edit' data-toggle='modal' style='display:none'></a>
	<div class="modal fade" id="cost_edit" tabindex="-20" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
		<%include("/eeda/component/form/detailTable.html", 
                                {
                                    id:'cost_table',
                                    style:'width:1800px',
                                    headers:['结算公司', '费用名称','单价', '数量', '单位','对账金额','对账币制', '对人民币汇率', '对账金额(人民币)','结算币制','结算汇率','结算金额','对人民币汇率','结算金额(人民币)','汇兑损益','备注',
                                    'sp_name', 'cost_name','unit_name','currency_name','audit_flag'],
                                    field_list:['sp_id', 'charge_id', 'price', 'amount', 'unit_id', 'total_amount','currency_id',
                                     'exchange_rate', 'currency_total_amount','exchange_currency_id','exchange_currency_rate','exchange_total_amount','exchange_currency_rate_rmb','exchange_total_amount_rmb','rmb_difference','remark','sp_name', 'charge_name',
                                     'unit_name','currency_name','exchange_currency_id_name','audit_flag'],
                                    value_list: costList![]
                                }){} %>
                     <div class="modal-footer">
		                 <button id="cost_saveBtn" type="button" class="btn btn_green save" data-dismiss="modal">保存</button>
		            	 <button type="button" class="btn  btn_white" data-dismiss="modal">返回</button>
	            	 </div>
            	</div>
        	</div>                  
    	</div>                    
	</div>
<!-- end of fade -->
<%}%>
<%include("/eeda/component/jsTemplate/tableInputDateField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableSelectTruckTypeField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputFieldCurrencyId.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputFinItemField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputAddressField.js",{}){} %>
<script>
	var itemOrder = {};
    requirejs(['/js/eeda/eeda-common.js'], function (common) {
        requirejs(['app/tradeArap/CostCheckOrder/edit']);
    });
</script>
