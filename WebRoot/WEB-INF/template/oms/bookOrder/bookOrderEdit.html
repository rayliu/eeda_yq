<%layout("/eeda/layout.html"){%>
<% var orderPermission = shiro.hasPermission("planOrder.order");
   var boolOrder = orderPermission;
   %>
   <link rel="stylesheet" href="/js/lib/jQuery-File-Upload-9.9.3/css/jquery.fileupload.css">
        <div id="page-wrapper">
        <form id="orderForm">
            <div class="row simple_search_div">
                <div class="col-lg-12">
                       <input id="order_id" type="hidden" name="order_id" value="${order.id!''}"/>
                       <input id="job_order_id" type="hidden" name="job_order_id" value="${jobOrder.id!''}"/>
                       <div class="row">
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'order_no', 
	                                                    label:'booking单号', 
	                                                    value:order.order_no!'',
	                                                    disabled: 'disabled'
	                                                }){}%>
	                        </div> 
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'plan_order_no', 
	                                                    label:'计划单号', 
	                                                    value:order.plan_order_no!'', 
	                                                    disabled: 'disabled'
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'job_order_no', 
	                                                    label:'关联单号', 
	                                                    value:jobOrder.order_no!'', 
	                                                    disabled: 'disabled'
	                                                }){}%>
	                        </div>
                    	</div>
                    	<div class="row"><!--  第4行  -->
                       		<div class="col-lg-4">
                             <%include("/eeda/component/form/inputDateQueryField.html", 
                             {	id:'create_stamp', 
                             	label:'本计划时间段', 
                             	value:''
                             }){} %>
                       		</div><!-- /.col-lg-4 -->
 					   		<div class="col-lg-4">
                            	<%include("/eeda/component/form/inputField.html", 
                                                {   id:'creator_name', 
                                                    label:'创建人', 
                                                    value:user.c_name!'', 
                                                    disabled: 'disabled'
                                                }){}%>
                        	</div>
                        	<div class="col-lg-4">
                            	<%include("/eeda/component/form/inputField.html", 
                                                {   id:'create_stamp', 
                                                    label:'创建时间', 
                                                    value:order.create_stamp!'', 
                                                    disabled: 'disabled'
                                                }){}%>
                        	</div>             
                    	</div>   
                    	
                    	<div class="form-group">
	                     	<label>备注</label>
	                     	<textarea id='note' class="form-control" rows="3" name="note">${order.remark!''}</textarea>
	               		 </div>
                    </div>
                </div>
                
                <div class="row simple_search_div" style="margin-top:18px">
                	<div class="col-lg-12">
                		<div style="width:10%;float:left;text-align:center;">
							<h4>Booking</h4>
							<% if(order.create_stamp!'' != null && order.create_stamp!'' !=''){%>
                				<span>创建时间：<br>${order.create_stamp!''}</span>
                			<%}%>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
                			<h4>—————></h4>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
                			<h4>派车</h4>
                			<% if(job_eta!'' != null && job_eta!'' !=''){%>
                				<span id="sendCar">预计${job_eta!''}到厂</span>
                			<%}%>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
                			<h4>—————></h4>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
							<h4>报关</h4>
							<% if(job_custom_order_no!'' != null && job_custom_order_no!'' !=''){%>
							<label id="custom">报关单号：</label>${job_custom_order_no!''}
							<%}%>
							<% if(job_status!'' != null && job_status!'' !=''){%>
							<br/>
							<label id="custom">状态：</label>${job_status!''}
							<%}%>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
                			<h4>—————></h4>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
							<h4>上船</h4>
							<span id="boarding"></span>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
                			<h4>—————></h4>
						</div>
                		<div style="width:10%;float:left;text-align:center;">
							<h4>到港</h4>
							<span id="arrival"></span>
						</div>
                	</div>
                </div>
                
                   
                 <div style="margin-left:15px; margin-top:15px">
	                 <div class="row small_head" ><div class="font_style">货品信息</div></div>
			         <div class="row simple_small_title_div">
			         <div style="margin-left:15px">
			             <div class="row">
			             	<div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'HBLconsignee', 
	                                                    label:'收货人', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.HBLconsignee_name!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'order_export_date', 
	                                                    label:'出货时间', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.order_export_date!''
	                                                }){}%>
	                        </div> 
	                         
                    	</div>
                    	<div class="row">
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'pieces', 
	                                                    label:'件数', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.pieces!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'gross_weight', 
	                                                    label:'毛重', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.gross_weight!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'volume', 
	                                                    label:'体积', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.volume!''
	                                                }){}%>
	                        </div>
	                        
                    	</div>
                    	<div class="row">
	                        
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'pol', 
	                                                    label:'启运港', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.pol_name!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'pod', 
	                                                    label:'目的港', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.pod_name!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'carrier_or_air_company', 
	                                                    label:'船东/航空公司', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.carrier_or_air_company!''
	                                                }){}%>
	                        </div>
	                        
	                        
                    	</div>
                    	<div class="row">
	                    	<div class="col-lg-4">
		                            <%include("/eeda/component/form/inputField.html", 
		                                                {   id:'vessel_voyage_or_flight_no_voyage_no', 
		                                                    label:'船名航次/航班信息', 
	                                                    disabled:'disabled',
		                                                    value:jobOrder.vessel_voyage_or_flight_no_voyage_no!''
		                                                }){}%>
		                    </div> 
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'ship_container_no', 
	                                                    label:'柜号', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.ship_container_no!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'ship_seal_no', 
	                                                    label:'封条号', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.ship_seal_no!''
	                                                }){}%>
	                        </div>
	                        
                    	</div>
                    	<div class="row">
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'closing_date', 
	                                                    label:'珠海截关日期', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.closing_date!''
	                                                }){}%>
	                        </div> 
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'etd', 
	                                                    label:'ETD', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.etd!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'eta', 
	                                                    label:'ETA', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.eta!''
	                                                }){}%>
	                        </div>
                    	</div>
                    	<div class="row">
                    		<div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'take_address', 
	                                                    label:'提货地点', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.take_address!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'truck_type', 
	                                                    label:'车型', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.truck_type!''
	                                                }){}%>
	                        </div> 
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'truck_count', 
	                                                    label:'车量', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.truck_count!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'pol', 
	                                                    label:'货名', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.pol!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'factory_loading_time', 
	                                                    label:'尺寸', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.factory_loading_time!''
	                                                }){}%>
	                        </div>
	                        <div class="col-lg-4">
	                            <%include("/eeda/component/form/inputField.html", 
	                                                {   id:'pol', 
	                                                    label:'货物动态', 
	                                                    disabled:'disabled',
	                                                    value:jobOrder.pol!''
	                                                }){}%>
	                        </div> 
                    	</div>
			         </div>
			         </div>
                 </div> 	 
            </form>
            
                   
                <div class="simple_order_list_div">
                    <ul id="orderTabs" class="nav nav-tabs">
                        <li class="active">
                            <a href="#itemDetail" data-toggle="tab">计划明细</a>
                        </li>
                    </ul>
                    <div class="form-group">
                        	<div class="col-lg-12"> 
                        		<div class="row simple_rectangle_title_div"><div class="font_style">第一步，接受头程资料</div></div>
					        	<div class="from-group">
					        		<%include("/eeda/component/form/detailTable.html", 
	                                    {
	                                        id:'zero_doc_table',
	                                        class:'item',
	                                        style:'width:1400px',
	                                        headers:['','操作', '文档名称', '上传人', '上传时间', '备注',
	                                        '发送人','发送时间','文件状态','',''],
	                                        field_list:['id','', 'doc_name','c_name','upload_time', 'remark','sender_name','send_time','send_status','new_count',''],
	                                        value_list: zeroDocList![]
	                                 }){} %>
					        	</div>
					        	 <br>
                        		<div class="row simple_rectangle_title_div"><div class="font_style">第二步，接受P/C资料上传</div></div>
                        		<div class="from-group">
					        		<span class="btn btn_grey btn-xs fileinput-button" id="fileuploadSpan"> 
                                    <i class="glyphicon glyphicon-plus"></i> 
                                    <span>选择文件</span> 
                                    <input id="oneUpload" type="file" name="files[]" multiple> 
	                                </span> 
	                                <%include("/eeda/component/form/detailTable.html", 
	                                    {
	                                        id:'one_doc_table',
	                                        class:'item',
	                                        style:'width:1400px',
	                                        headers:['','操作', '文档名称', '上传人', '上传时间', '备注',
	                                        '发送人','发送时间','文件状态'],
	                                        field_list:['id','', 'doc_name','c_name','upload_time', 'remark','sender_name','send_time','send_status'],
	                                        value_list: oneDocList![]
	                                    }){} %>
						        </div>
						        <br>
						        <div class="row simple_rectangle_title_div"><div class="font_style">第三步，B/L文件下载，接受被委托方资料</div></div>
					        	<div class="from-group">
					        		<%include("/eeda/component/form/detailTable.html", 
	                                    {
	                                        id:'two_doc_table',
	                                        class:'item',
	                                        style:'width:1400px',
	                                        headers:['','操作', '文档名称', '上传人', '上传时间', '备注',
	                                        '发送人','发送时间','文件状态','',''],
	                                        field_list:['id','', 'doc_name','c_name','upload_time', 'remark','sender_name','send_time','send_status','new_count',''],
	                                        value_list: twoDocList![]
	                                 }){} %>
					        	</div>
					        	 <br>
					        	<div class="row simple_rectangle_title_div"><div class="font_style">第四步，盖章保函资料上传，将文件发送给被委托方</div></div>
					        	<div class="from-group">
					        		<span class="btn btn_grey btn-xs fileinput-button" id=""> 
                                    <i class="glyphicon glyphicon-plus"></i> 
                                    <span>选择文件</span> 
                                    <input id="threeUpload" type="file" name="files[]" multiple> 
	                                </span> 
	                                <%include("/eeda/component/form/detailTable.html", 
	                                    {
	                                        id:'three_doc_table',
	                                        class:'item',
	                                        style:'width:1400px',
	                                        headers:['','操作', '文档名称', '上传人', '上传时间', '备注',
	                                        '发送人','发送时间','文件状态'],
	                                        field_list:['id','', 'doc_name','c_name','upload_time', 'remark','sender_name','send_time','send_status'],
	                                        value_list: threeDocList![]
	                                    }){} %>
					        	</div>
					        	 <br>
					        	<div class="row simple_rectangle_title_div"><div class="font_style">第五步，接收下载</div></div>
					        	<div class="from-group">
					        		<%include("/eeda/component/form/detailTable.html", 
	                                    {
	                                        id:'four_doc_table',
	                                        class:'item',
	                                        style:'width:1400px',
	                                        headers:['','操作', '文档名称', '上传人', '上传时间', '备注',
	                                        '发送人','发送时间','文件状态','',''],
	                                        field_list:['id','', 'doc_name','c_name','upload_time', 'remark','sender_name','send_time','send_status','new_count',''],
	                                        value_list: fourDocList![]
	                                    }){} %>
					        	</div>
                            </div>
                        </div>

                    
                    <div class="button-bar">
                        <a id='saveBtn' class="btn btn_green" href="#">保存</a>
                        <button id='submitBtn' class="btn btn_green" href="#">提交</button>
                        <%if(boolOrder){%>
                        <button id="confirmCompleted" class="btn btn-primary">计划订单锁单</button>
                        <%}%>
                        <a class="btn btn_white" href="/planOrder">返回</a>
                        <button id='allShipmentBtn' class="btn btn_green">批量出货</button>
                    </div>
                    
                </div>
      
</div>
<div class="modal fade" id="sendDetail">
	  <div class="modal-dialog modal-lg" style="width:1000px;">
	    <div class="modal-content">
	      <div class="modal-header">发送邮件详情</div>
	      	<div class="modal-body">
				<div class="form-group">
				
				<div class="panel panel-default">
				    <div class="panel-heading">
				        <h4 class="panel-title">
				            <a data-toggle="collapse" data-parent="#accordion" href="#collapseEmailInfo" aria-expanded="false" class="collapsed">
				            <i id="collapseEmailIcon" class="fa 
				            <%if(order.id!''==''){%>fa-angle-double-up<%}else{%>fa-angle-double-down<%}%>"></i> 常用邮箱信息
				            </a>
				        </h4>
				    </div>
				    <div id="collapseEmailInfo" class="panel-collapse collapse <%if(order.id!''==''){%>in<%}%>" aria-expanded="false" style="height: auto;">
				        <div class="panel-body">
				            <ul id="useEmailTemplate" class="useEmailTemplate">
				              <%for(Info in emailTemplateInfo![]){%>
				                    <li id="${Info.id}"
				                        email="${Info.receive_mail}"
				                        ccEmail="${Info.cc_mail}"
				                        bccEmail="${Info.bcc_mail}" >
				                      <div class="radio">
				                        <label>
				                            <input type="radio" value="1" name="useEmailTemplate" style="margin-top: 0px;">
				                            <font size="3px"><span>名称:${Info.remark}</span></font><br> 
				                            <span>收件人:${Info.receive_mail}<br>抄送人:${Info.cc_mail}<br>密送人: ${Info.bcc_mail}</span><br>
				                        </label>
				                        <a class="deleteEmailTemplate" href="#" style="margin-right: 10px;padding-top: 6px;float: left;">删除</a>
				                      </div>
				                    </li>
				              <%}%>
				            </ul>
				        </div>
				    </div>
				</div>
				
				<form id="emailForm">
					  <font size="5px"><span id="attachment"></span></font><br><br>   
	                  <label>收件人</label>
	                  <textarea id="email" name="email" class="form-control" rows="3" required></textarea><br>
	                  <label>抄送人</label>
	                  <textarea id="ccEmail" name="ccEmail" class="form-control" rows="3"></textarea><br>
	                  <label>密送人</label>
	                  <textarea id="bccEmail" name="bccEmail" class="form-control" rows="3"></textarea><br>
	                  <label>邮件标题</label>
	                  <input type="text" id="emailTitle" name="emailTitle" class="form-control"><br>
	                  <label>邮件正文</label>
	                  <textarea id='emailContent' class="form-control" rows="5"></textarea><br>
	                  <label>常用邮箱模版名称</label>
	                  <textarea id='emailTemplateRemark' class="form-control" rows="2"></textarea><br>
				</form>
				</div>   
	        </div>
	        <div class="modal-footer button-bar">
	        	<button id="confirmSendBtn" class="btn btn_green">发送</button>
	        	<button id="addEmailTemplate" class="btn btn_green">添加常用邮箱模版</button>
	            <button id="returnBtn" class="btn  btn_white" data-dismiss="modal">返回</button>
	        </div>
	    </div>
	  </div>
	</div>


<%}%>
<%include("/eeda/component/jsTemplate/tableInputDateField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableSelectTruckTypeField.js",{}){} %>

<div class="blockUI" style="display:none"></div>
<div class="blockUI blockOverlay" style="z-index: 1000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px; background-color: rgb(0, 0, 0); opacity: 0.6; cursor: wait; position: fixed;"></div>
<div class="blockUI blockMsg blockPage" style="z-index: 1011; position: fixed; padding: 0px; margin: 0px; width: 30%; top: 40%; left: 35%; text-align: center; color: rgb(0, 0, 0); border: 3px solid rgb(170, 170, 170); background-color: rgb(255, 255, 255); cursor: wait;"><h4><img src="/images/loading.gif" style="height: 20px; margin-top: -3px;"></h4></div>

<script>
    var order_no = '${order.order_no!'订单编辑'}'; 
    var itemOrder = {};
</script>
<script>
    requirejs(['/js/eeda/eeda-common.js'], function (common) {
        requirejs(['app/oms/bookOrder/edit']);
        requirejs(['app/oms/bookOrder/edit_doc_table','app/oms/bookOrder/edit_file_upload']); 
    });

</script>
