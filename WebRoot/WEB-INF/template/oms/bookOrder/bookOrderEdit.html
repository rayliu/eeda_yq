<%layout("/eeda/layout.html"){%>
<% var orderPermission = shiro.hasPermission("planOrder.order");
   var boolOrder = orderPermission;
   %>
   <link rel="stylesheet" href="/js/lib/jQuery-File-Upload-9.9.3/css/jquery.fileupload.css">
        <div id="page-wrapper">
            <div class="row simple_search_div">
                <div class="col-lg-12">
                    <input id="order_id" type="hidden" name="order_id" value="${order.id!''}"/>
                   <form id="orderForm">
                       <div class="row">
                        <div class="col-lg-4">
                            <%include("/eeda/component/form/inputField.html", 
                                                {   id:'order_no', 
                                                    label:'booking单号', 
                                                    value:order.order_no!'',
                                                    disabled: 'disabled'
                                                }){}%>
                        </div> 
                        <div class="col-lg-4">
                            <%include("/eeda/component/form/inputField.html", 
                                                {   id:'plan_order_no', 
                                                    label:'工作单好', 
                                                    value:order.plan_order_no!'', 
                                                    disabled: 'disabled'
                                                }){}%>
                        </div>
                        <div class="col-lg-4">
                            <%include("/eeda/component/form/inputField.html", 
                                                {   id:'job_order_no', 
                                                    label:'关联单号', 
                                                    value:order.job_order_no!'', 
                                                    disabled: 'disabled'
                                                }){}%>
                        </div>
                           
                       
                    </div>
                    <div class="row"><!--  第4行  -->
                       <div class="col-lg-4">
                             <%include("/eeda/component/form/inputDateQueryField.html", 
                             {	id:'create_stamp', 
                             	label:'本计划时间段', 
                             	value:''
                             }){} %>
                       </div><!-- /.col-lg-4 -->
 					   <div class="col-lg-4">
                            <%include("/eeda/component/form/inputField.html", 
                                                {   id:'creator_name', 
                                                    label:'创建人', 
                                                    value:user.c_name!'', 
                                                    disabled: 'disabled'
                                                }){}%>
                        </div>
                        <div class="col-lg-4">
                            <%include("/eeda/component/form/inputField.html", 
                                                {   id:'create_stamp', 
                                                    label:'创建时间', 
                                                    value:order.create_stamp!'', 
                                                    disabled: 'disabled'
                                                }){}%>
                        </div>             
                    </div>               
                </form>
                            
                                <div class="form-group">
                                 <label>备注</label>
                                 <textarea id='note' class="form-control" rows="3" name="note">${order.remark!''}</textarea>
                                </div>
            
                </div>
            </div>
  
                   
                <div class="">
                    <ul id="orderTabs" class="nav nav-tabs">
                        <li class="active">
                            <a href="#itemDetail" data-toggle="tab">计划明细</a>
                        </li>
                    </ul>
                    <div class="form-group">
                        	<div class="col-lg-12"> 
                                <div class="row simple_rectangle_title_div"><div class="font_style">Document Information 文档信息</div></div>
                                <span class="btn btn_grey btn-xs fileinput-button" id="fileuploadSpan"> 
                                    <i class="glyphicon glyphicon-plus"></i> 
                                    <span>选择文件</span> 
                                    <input id="fileupload" type="file" name="files[]" multiple> 
                                </span> 
                               <!--  <a data-target='#sendDetail' data-toggle='modal'>
                                    <button id="sendEmail" class="btn btn_green btn-xs">发送邮件</button>
                                </a> -->
                                <%include("/eeda/component/form/detailTable.html", 
                                    {
                                        id:'doc_table',
                                        class:'item',
                                        style:'width:1400px',
                                        headers:['<input id="allCheckOfDoc" type="checkbox" style="width:30px">','操作', '文档名称', '上传人', '上传时间', '备注',
                                        '发送人','发送时间','文件状态'],
                                        field_list:['id','', 'doc_name','c_name','upload_time', 'remark','sender','send_time','send_status'],
                                        value_list: docList![]
                                    }){} %>
                                 <br>
                                 <div class="row simple_rectangle_title_div"><div class="font_style">Send Massage 发送记录</div></div>
                                <%include("/eeda/component/form/detailTable.html", 
                                {
                                    id:'email_table', 
                                    class:'item',
                                    style:'width:2000px',
                                    headers:['邮件标题','发送文档','收件人','抄送人','密送人', '发送人','发送时间'],
                                    field_list:['mail_title', 'doc_name','receive_mail','cc_mail','bcc_mail','sender','send_time'],
                                    value_list: mailList![]
                                }){} %>
                            </div>
                        </div>

                    
                    <div class="button-bar">
                        <a id='saveBtn' class="btn btn_green" href="#">保存</a>
                        <button id='submitBtn' class="btn btn_green" href="#">提交</button>
                        <%if(boolOrder){%>
                        <button id="confirmCompleted" class="btn btn-primary">计划订单锁单</button>
                        <%}%>
                        <a class="btn btn_white" href="/planOrder">返回</a>
                        <button id='allShipmentBtn' class="btn btn_green">批量出货</button>
                    </div>
                    
                </div>
            </div>
      

<div class="modal fade" id="sendDetail">
	  <div class="modal-dialog modal-lg" style="width:1000px;">
	    <div class="modal-content">
	      <div class="modal-header">发送邮件详情</div>
	      	<div class="modal-body">
				<div class="form-group">
				
				<div class="panel panel-default">
				    <div class="panel-heading">
				        <h4 class="panel-title">
				            <a data-toggle="collapse" data-parent="#accordion" href="#collapseEmailInfo" aria-expanded="false" class="collapsed">
				            <i id="collapseEmailIcon" class="fa 
				            <%if(order.id!''==''){%>fa-angle-double-up<%}else{%>fa-angle-double-down<%}%>"></i> 常用邮箱信息
				            </a>
				        </h4>
				    </div>
				    <div id="collapseEmailInfo" class="panel-collapse collapse <%if(order.id!''==''){%>in<%}%>" aria-expanded="false" style="height: auto;">
				        <div class="panel-body">
				            <ul id="useEmailTemplate" class="useEmailTemplate">
				              <%for(Info in emailTemplateInfo![]){%>
				                    <li id="${Info.id}"
				                        email="${Info.receive_mail}"
				                        ccEmail="${Info.cc_mail}"
				                        bccEmail="${Info.bcc_mail}" >
				                      <div class="radio">
				                        <label>
				                            <input type="radio" value="1" name="useEmailTemplate" style="margin-top: 0px;">
				                            <font size="3px"><span>名称:${Info.remark}</span></font><br> 
				                            <span>收件人:${Info.receive_mail}<br>抄送人:${Info.cc_mail}<br>密送人: ${Info.bcc_mail}</span><br>
				                        </label>
				                        <a class="deleteEmailTemplate" href="#" style="margin-right: 10px;padding-top: 6px;float: left;">删除</a>
				                      </div>
				                    </li>
				              <%}%>
				            </ul>
				        </div>
				    </div>
				</div>
				
				<form id="emailForm">
					  <font size="5px"><span id="attachment"></span></font><br><br>   
	                  <label>收件人</label>
	                  <textarea id="email" name="email" class="form-control" rows="3" required></textarea><br>
	                  <label>抄送人</label>
	                  <textarea id="ccEmail" name="ccEmail" class="form-control" rows="3"></textarea><br>
	                  <label>密送人</label>
	                  <textarea id="bccEmail" name="bccEmail" class="form-control" rows="3"></textarea><br>
	                  <label>邮件标题</label>
	                  <input type="text" id="emailTitle" name="emailTitle" class="form-control"><br>
	                  <label>邮件正文</label>
	                  <textarea id='emailContent' class="form-control" rows="5"></textarea><br>
	                  <label>常用邮箱模版名称</label>
	                  <textarea id='emailTemplateRemark' class="form-control" rows="2"></textarea><br>
				</form>
				</div>   
	        </div>
	        <div class="modal-footer button-bar">
	        	<button id="confirmSendBtn" class="btn btn_green">发送</button>
	        	<button id="addEmailTemplate" class="btn btn_green">添加常用邮箱模版</button>
	            <button id="returnBtn" class="btn  btn_white" data-dismiss="modal">返回</button>
	        </div>
	    </div>
	  </div>
	</div>


<%}%>
<%include("/eeda/component/jsTemplate/tableInputDateField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableSelectTruckTypeField.js",{}){} %>

<div class="blockUI" style="display:none"></div>
<div class="blockUI blockOverlay" style="z-index: 1000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px; background-color: rgb(0, 0, 0); opacity: 0.6; cursor: wait; position: fixed;"></div>
<div class="blockUI blockMsg blockPage" style="z-index: 1011; position: fixed; padding: 0px; margin: 0px; width: 30%; top: 40%; left: 35%; text-align: center; color: rgb(0, 0, 0); border: 3px solid rgb(170, 170, 170); background-color: rgb(255, 255, 255); cursor: wait;"><h4><img src="/images/loading.gif" style="height: 20px; margin-top: -3px;"></h4></div>

<script>
    var order_no = '${order.order_no!'订单编辑'}'; 
    var itemOrder = {};
</script>
<script>
    requirejs(['/js/eeda/eeda-common.js'], function (common) {
        requirejs(['app/oms/bookOrder/edit']);
        requirejs(['app/oms/bookOrder/edit_doc_table','app/oms/bookOrder/edit_file_upload']); 
    });

</script>
