<%layout("/eeda/layout.html"){%>
<div id="page-wrapper">
	<input id="order_id" type="hidden" name="order_id" value="${order.id!''}" />
	<input id="company_id" type="hidden" name="company_id" value="${order.company_id!''}" />
	<input id="company_abbr" type="hidden" name="company_abbr" value="${order.company_abbr!''}" />
	<input id="jor_id" type="hidden" name="jor_id" value="" />
	<div class="row simple_search_div">
        <div class="col-lg-12">
		<form id="orderForm">
			<input id="sp_id" type="hidden" name="sp_id" value="${order.sp_id!''}" />
				<!--  第1行  -->
		   	<!--  第2行  -->
	 
			<div class="row">
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", {
					id:'order_no', label:'对账单号', value:order.order_no!'', disabled:
					'disabled' }){}%>
				</div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'status',
					label:'单据状态', value:order.audit_status!order.status!'新建', disabled: 'disabled' }){}%>
				</div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", {
					id:'creator_name',
					 label:'创建人', value:order.user!order.creator_name!'',
					 disabled:'disabled' 
					 }){}%>
				</div>
			</div>
			<!--  第3行  -->
			<div class="row">
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", {
					id:'create_stamp', label:'创建时间', value:order.create_stamp!'',
					disabled: 'disabled' }){}%>
				</div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", {
					 id:'confirm_name',
					 label:'确认人',
					 value:order.confirm_by_name!'', 
					 disabled:'disabled' 
					 }){}%>
				</div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", {
					id:'confirm_stamp', label:'确认时间',
					value:order.confirm_stamp!'',
					disabled: 'disabled'
					 }){}%>
				</div>
			</div>
			<!--  第4行  -->
			<div class="row">
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'company_name',
					label:'结算公司', value:order.company_name!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'address',
					label:'地址', value:order.address!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'customer',
					label:'联系人', value:order.customer!'',disabled:'disabled'
					}){}%>
				</div>
			</div>
			<!--  第5行  -->
			<div class="row">
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'phone',
					label:'电话', value:order.phone!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-4">	
					<%include("/eeda/component/form/inputDateQueryField.html", { id:'check_time',
					label:'对账时间', begin_value:order.begin_time!'', end_value:order.end_time!'', disabled: 'disabled' 
					}){}%>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<label>备注</label>
					<textarea id='remark' class="form-control" rows="3" name="remark">${order.remark!''}</textarea>
				</div>
			</div><br><br>
			
		<!--  	<div class="row">
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'total_amount',
					label:'应收总金额(CNY)', value:order.total_amount!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'check_amount',
					label:'对账总金额(CNY)', value:order.check_amount!order.total_amount!'',disabled:'disabled'
					}){}%>
				</div>
			</div>      -->
			<div class="row">
				<div class="form-group">
					<div class="col-lg-12">
						<h4>对账币值金额汇总</h4>
					</div>
				</div>
		   </div>
			<div class="row">
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'cny_duizhang',
					label:'应收CNY', value:order.cny_duizhang!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'usd_duizhang',
					label:'应收USD', value:order.usd_duizhang!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'hkd_duizhang',
					label:'应收HKD', value:order.hkd_duizhang!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'jpy_duizhang',
					label:'应收JPY', value:order.jpy_duizhang!'',disabled:'disabled'
					}){}%>
				</div>
			</div>

			<div class="row">
				<div class="form-group">
					<div class="col-lg-12">
						<h4>结算汇总金额</h4>
					</div>
				</div>
		   </div>
			<div class="row">
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'cny',
					label:'应收CNY', value:order.cny!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'usd',
					label:'应收USD', value:order.usd!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'hkd',
					label:'应收HKD', value:order.hkd!'',disabled:'disabled'
					}){}%>
				</div>
				<div class="col-lg-3">
					<%include("/eeda/component/form/inputField.html", { id:'jpy',
					label:'应收JPY', value:order.jpy!'',disabled:'disabled'
					}){}%>
				</div>
			</div>
			<div class="row"  style="display:none">
				<!--  第4行  -->
				<div class="col-lg-4">
					<div class="form-group">
                         <label class="label-margin">是否开票</label>
                        	<label class="radio-inline">
                             <input type="radio" name="invoiceType" value="Y" <% if(order.have_invoice!''=='Y'||order.have_invoice==''){ %>checked="checked"<% }%>>是
                         </label>
                        	 <label class="radio-inline">
                             <input type="radio" name="invoiceType"  value="N" <% if(order.have_invoice!'N'=='N'){%>checked="checked"<% }%>>否
                         </label>
                     </div>
                </div>
			</div>
			<div class="row" id="invoice_flag" <% if(order.have_invoice!'N'=='N'){%>style="display:none"<% }%>>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'billing_unit',
					label:'开票单位', value:order.billing_unit!''}){}%></div>
				<div class="col-lg-4">
					<%include("/eeda/component/form/inputField.html", { id:'payee',
					label:'收款人', value:order.payee!''}){}%></div>
			</div>

			
		</form>
		</div>
	</div>

	<div class="simple_order_list_div">
	<div class="group-form" style="margin-top: 15px;">
		<ul id="orderTabs" class="nav nav-tabs">
			<li class="active"><a href="#itemDetail" data-toggle="tab"
				id="costCheckOrderItem">明细信息</a></li>
		</ul>
		<br/>
		<div class="col-lg-12">
				<div class="row">
					 <div class="col-lg-4">
                        <%include("/eeda/component/form/selectField.html", 
                                    {   id:'query_currency',
                                        label:'选中查询币种', 
                                        value:'',
                                        value_list:[
                                        	{code:'',value:''},
                                            {code:'CNY', value:'CNY'},
                                            {code:'USD', value:'USD'},
                                            {code:'HKD', value:'HKD'},
                                            {code:'JPY', value:'JPY'}
                                        ]
                                    }){}%>
                    </div>
                    <button id='query_listCurrency' class="btn btn_grey">查询</button>
				</div>
			<div class="group-form"  id="currencyDiv">
                <div class="row">
                    <div class="col-lg-4">
                        <%include("/eeda/component/form/selectField.html", 
                                    {   id:'exchange_currency',
                                        label:'选中行', 
                                        value:'',
                                        value_list:[
                                            {code:'CNY', value:'兑换成CNY'},
                                            {code:'USD', value:'兑换成USD'},
                                            {code:'HKD', value:'兑换成HKD'},
                                            {code:'JPY', value:'兑换成JPY'}
                                        ]
                                    }){}%>
                    </div>
                    <div class="col-lg-4">
	                       	 <%include("/eeda/component/form/inputField.html", { id:'exchange_rate',
	                        label:'兑换汇率'
                        }){}%>
                    </div>
                    <button id='exchange' class="btn btn_green">兑换</button>
                </div>
	        </div>
	        <div class="table_btn_bar">
	        	<button class="btn btn_blue" id="add_charge">添加明细</button> 
	        </div><br/>

	        </div>
						<%include("/eeda/component/form/detailTable.html", 
                            {
                                id:'eeda-table', 
                                style:'width:1600px',
                                headers:[
                                	'<input type="checkbox" id="allcheck">',
                                	
                                	'操作',
                                    '工作单号',
                                    '出货日期',			                                       
                                    '结算公司',
                                    '费用名称',
                                    '对账币制',
                                    '对账金额', 
                                    '原汇率',
                                    '原总金额(CNY)',
                                    '当前汇率',  
                                    '当前总金额(CNY)',
                                    '结算币制', 
                                    '结算汇率', 
                                    '结算金额',                                     
                                    '体积',
                                    '箱量',
                                    '重量',
                                    '箱号',
                                    'REF_NO',
                                    'MBL_NO',
                                    'HBL_NO',
                                    '',
                                    ''	                                        
                                ],
					field_list:['id','','order_no','order_export_date','sp_name','fin_name','currency_name','total_amount','exchange_rate','after_total',
					'new_rate','after_rate_total','exchange_currency_name','exchange_currency_rate','exchange_total_amount','vgm','container_amount',
					'gross_weight','container_no','ref_no','mbl_no','hbl_no','order_type', 'job_order_id'], value_list: order.itemList!item_list![] }){} %>
			
		</div>
	
	<div class="form-group">
		<div class="col-lg-12">
			<br>
			<button id='saveBtn' class="btn  btn_green" disabled >保存</button> 
			<% if(shiro.hasPermission("chargeCheckOrder.confirm")){%>
            	<button id="confirmBtn" type="button" class="btn btn_green" disabled>确认</button>
            <%}%>
            <button id="cancelConfirmBtn" type="button" class="btn btn_green" disabled>取消确认</button>
            <button id="printBtn" type="button" class="btn  btn_white"  >生成对账单PDF(明细)</button>
			<button id="printTotaledBtn" type="button" class="btn  btn_white"  >生成对账单PDF(合计)</button>
			<button id="exportTotaledExcel" type="button" class="btn  btn_white"  >导出excel对账单</button>
			<a class="btn  btn_white" href="/chargeCheckOrder">返回</a>
			<a href="/chargeRequest/create" class="btn btn_green" type="button" >创建申请单</a>
		</div>
		<!-- /.col-lg-12 -->
		<br/>
	</div>
	</div>

  <a id='charge_table_msg_btn' data-target='#charge_table_msg' data-toggle='modal' style='display:none'></a>
  <div class="modal fade" id="charge_table_msg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
				  <div class="row">
                        <div class="col-lg-4">
                            <%include("/eeda/component/form/inputSpField.html", 
                                {
                                    id:'que_sp', 
                                    label:'结算公司', 
                                    value: '',
                                    required: 'required'
                            }){} %>
                        </div>
                        <div class="col-lg-4">
                            <%include("/eeda/component/form/inputField.html", 
                                {   id: 'que_order_no', 
                                    label: '工作单号', 
                                    value: ''
                                }){}%>
                        </div>    
                  </div>    
                   <div class="row">
                        <div class="col-lg-4">
	                         <%include("/eeda/component/form/inputDateQueryField.html", 
			                         {   id:'que_order_export_date', 
			                             label:'出货日期'
			                         }){} %>
	                     </div>
	                     <div class="col-lg-4">
                                <%include("/eeda/component/form/inputCustomerField.html", 
                                     {   id: 'que_customer', 
                                         label: '客户', 
                                         value: ''
                                     }){}%>
                       </div>
                  </div>    
			 		 <div class="form-group button-bar" >
                        <button id="searchBtn" class="btn btn_grey" type="button">查询</button>
                        <button id="resetBtn" class="btn btn_white btn-sm" type="button">清空条件</button>
                        &nbsp&nbsp<input type="checkbox" name="checkOrderAll" id="checkOrderAll" value="Y">查看应收应付<span style="color:red">(红色为应付)</span>
                    </div>
				  <br>
				  <%include("/eeda/component/form/detailTable.html", 
			      {
			          id:'eeda_charge_table',
			          style:'width:2550px',
			          headers:['<input type="checkbox" id="allCharge">','工作单号','出货时间','创建时间','类型','费用名称','客户','结算公司',
	                                             '对账金额','对账币制','对人民币汇率','总金额（CNY）','结算币制','结算汇率','结算金额',
	                                             'FND', '体积(CBM)', '箱量', '净重重量', 'REF_NO', 'MBL_NO','HBL_NO','柜号','车型'
	                                            ],
			          field_list:['id','', 'type', 'sp_id', 'charge_id','charge_eng_id', 'price', 'amount', 'unit_id', 'total_amount','currency_id',
			           'exchange_rate', 'currency_total_amount','exchange_currency_id','exchange_currency_rate','exchange_total_amount','remark','sp_name', 'charge_name','charge_name_eng','unit_name','currency_name','EXCHANGE_CURRENCY_ID_NAME','audit_flag'],
			          value_list: chargeList![]
			      }){} %>
			</div>
            <div class="modal-footer">
           		 <button id="add_charge_item" type="button" class="btn btn_green save" data-dismiss="modal">添加</button>
            	 <button type="button" class="btn  btn_white" data-dismiss="modal">返回</button>
           </div>
        </div>
    </div>
</div>
	<a id='charge_editBtn' data-target='#charge_edit' data-toggle='modal' style='display:none'></a>
	<div class="modal fade" id="charge_edit" tabindex="-20" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
		<%include("/eeda/component/form/detailTable.html", 
                                {
                                    id:'charge_table',
                                    style:'width:1400px',
                                    headers:['结算公司', '费用名称','单价', '数量', '单位','对账金额','对账币制', '对人民币汇率', '对账金额(人民币)','结算币制','结算汇率','结算金额','对人民币汇率','结算金额(人民币)','汇兑损益','备注',
                                    'sp_name', 'charge_name','unit_name','currency_name','audit_flag'],
                                    field_list:['sp_id', 'charge_id', 'price', 'amount', 'unit_id', 'total_amount','currency_id',
                                     'exchange_rate', 'currency_total_amount','exchange_currency_id','exchange_currency_rate','exchange_total_amount','exchange_currency_rate_rmb','exchange_total_amount_rmb','rmb_difference','remark','sp_name', 'charge_name',
                                     'unit_name','currency_name','exchange_currency_id_name','audit_flag'],
                                    value_list: chargeList![]
                                }){} %>
                     <div class="modal-footer">
		                 <button id="charge_saveBtn" type="button" class="btn btn_green save" data-dismiss="modal">保存</button>
		            	 <button type="button" class="btn  btn_white" data-dismiss="modal">返回</button>
	            	 </div>
            	</div>
        	</div>                  
    	</div>                    
	</div>
</div>
<%}%>

<%include("/eeda/component/jsTemplate/tableInputDateField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableSelectTruckTypeField.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputFieldCurrencyId.js",{}){} %>
<%include("/eeda/component/jsTemplate/tableInputFinItemField.js",{}){} %>

<%include("/eeda/component/jsTemplate/tableInputAddressField.js",{}){} %>



<script> 
    var itemOrder = {};
</script>
<script>
    requirejs(['/js/common.js', '/js/eeda/eeda-common.js'], function (common) {
        requirejs(['app/arap/ChargeCheckOrder/edit']);
    });
</script>
