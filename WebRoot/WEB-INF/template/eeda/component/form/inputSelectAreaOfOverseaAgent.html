<div class="form-group">
    <label>${label}
    <%if(required!'' =='required'){%>
        <span style='color:red; display:initial;'>*</span>
    <%}%>
    </label>
    <input type="text" class="form-control" autocomplete="false"
    id="${id}_input" name="${id}_input"
    placeholder="${placeholder!'请选择'}"  value="${display_value!''}" ${required!''} ${disabled!''}>
    <ul id='${id}_list' tabindex="-1" 
        class="pull-right dropdown-menu default dropdown-scroll" 
        style="top: 22%; left: 33%;">
    </ul>
    <textarea id="${id}_info" name="${id}_info" class="form-control" rows="${rows!'5'}" style="margin-top: 5px;"
    ${required!''} ${disabled!''}>${textarea_value !''}</textarea>
    <input id="${id}" style="display: none;" name="${id}" value="${value!''}"/>
</div>
<script>
$(document).ready(function() {
    //获取客户列表，自动填充
    var companyList =$("#${id}_list");
    var inputField = $('#${id}_input');
    var hiddenField = $('#${id}');
    var infoField = $('#${id}_info');
    
    inputField.on('keyup click', function(event){
        var me = this;
        var inputStr = inputField.val();
        
         $.get("/customer/searchParty", {partyName:inputStr, type: '${type}'}, function(data){
            if(inputStr!=inputField.val()){//查询条件与当前输入值不相等，返回
                return;
            }
            companyList.empty();
            for(var i = 0; i < data.length; i++)
                companyList.append("<li><a tabindex='-1' class='fromLocationItem' post_code='"+data[i].POSTAL_CODE+"' contact_person='"+data[i].CONTACT_PERSON+"' contact_person_eng='"+data[i].CONTACT_PERSON_ENG+"' email='"+data[i].EMAIL+"' phone='"+data[i].PHONE+"' partyId='"+data[i].ID+"' address='"+data[i].ADDRESS+"' address_eng='"+data[i].ADDRESS_ENG+"', company_name='"+data[i].COMPANY_NAME+"', >"+data[i].ABBR+"</a></li>");
                
            companyList.css({ 
                left:$(me).position().left+"px", 
                top:$(me).position().top+28+"px" 
            });
            eeda.hidePopList();
            companyList.show();  
            //当查询结果只有一个时，自动赋值到hiddenField
            if(data.length==0)
                hiddenField.val('');
            if(data.length==1&&data[0].ID)
                hiddenField.val(data[0].ID);
            if(data.length>1)
                hiddenField.val('');    
        },'json');
    });
    
    companyList.on('click', '.fromLocationItem', function(e){
        inputField.val($(this).text());
        companyList.hide();
        var companyId = $(this).attr('partyId');
        hiddenField.val(companyId);
        var info = $(this).attr('address')+'\r'+$(this).attr('contact_person')+'\r'+$(this).attr('phone');
        infoField.val(info);
    });

    // 1 没选中客户，焦点离开，隐藏列表
    inputField.on('blur', function(){
        if (inputField.val().trim().length ==0) {
            hiddenField.val('');
        };
        if (hiddenField.val().trim().length ==0) {
            inputField.val('');
        };
        companyList.hide();
    });
    
    // 2 当用户只点击了滚动条，没选客户，再点击页面别的地方时，隐藏列表
    companyList.on('mousedown', function(){
        return false;//阻止事件回流，不触发 $('#spMessage').on('blur'
    });
    
});
</script>