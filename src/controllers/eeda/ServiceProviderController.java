package controllers.eeda;import java.util.Date;import java.util.HashMap;import java.util.List;import java.util.Map;import models.eeda.ServiceProvider;import org.apache.commons.mail.DefaultAuthenticator;import org.apache.commons.mail.Email;import org.apache.commons.mail.SimpleEmail;import org.apache.shiro.SecurityUtils;import org.apache.shiro.subject.Subject;import com.jfinal.core.Controller;import com.jfinal.log.Log;import com.jfinal.plugin.activerecord.Db;import com.jfinal.plugin.activerecord.Record;import controllers.eeda.util.DataTablesUtils;public class ServiceProviderController extends Controller {    private Log logger = Log.getLog(ServiceProviderController.class);    Subject currentUser = SecurityUtils.getSubject();    private boolean isAuthenticated() {        if (!currentUser.isAuthenticated()) {            redirect("/login");            return false;        }        setAttr("userId", currentUser.getPrincipal());        return true;    }    public void index() {        if (!isAuthenticated())            return;        List<ServiceProvider> spList = ServiceProvider.dao.find("select * from DP_PROF_PROVIDER_INFO ");        System.out.println("size:" + spList.size());        render("/eeda/sp/list.html");    }    public void edit() {        if (!isAuthenticated())            return;        String id = getPara();        ServiceProvider sp = null;        if (id != "") {            sp = ServiceProvider.dao.findById(id);        }        setAttr("sp", sp);        render("/eeda/sp/spForm.html");    }    public void save() {        if (!isAuthenticated())            return;        String id = getPara("spId");        ServiceProvider sp = null;        if (id != "") {            sp = ServiceProvider.dao.findById(id);            sp.set("email", getPara("email"));            sp.set("contact", getPara("contact"));            sp.set("phone_no", getPara("phone_no"));            sp.set("address1", getPara("address1"));            sp.set("fax_no", getPara("fax_no")).update();        }        redirect("/sp/edit/" + id);    }    public void list() {        if (!isAuthenticated())            return;        String sLimit = "";        String pageIndex = getPara("sEcho");        if (getPara("iDisplayStart") != null && getPara("iDisplayLength") != null) {            sLimit = " LIMIT " + getPara("iDisplayStart") + ", " + getPara("iDisplayLength");        }        String strWhere = DataTablesUtils.buildSingleFilter(this);        Record rec = Db.findFirst("select count(1) total from DP_PROF_PROVIDER_INFO " + strWhere);        List<ServiceProvider> spList = ServiceProvider.dao.find("select * from DP_PROF_PROVIDER_INFO " + strWhere + sLimit);        System.out.println("size:" + spList.size());        Map orderMap = new HashMap();        orderMap.put("sEcho", pageIndex);        orderMap.put("iTotalRecords", rec.getLong("total"));        orderMap.put("iTotalDisplayRecords", rec.getLong("total"));        orderMap.put("aaData", spList);        renderJson(orderMap);    }    }